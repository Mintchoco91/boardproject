<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.boardproject.cm.service.impl.CmDAO">
 
	<!-- property : vo에서 변수명.  column : DB상 컬럼명  -->
	 <resultMap id="BoardVOarr" type="BoardVO">
	 	<result property="idx" column="idx"/>
	 	<result property="boardId" column="boardId"/>
	 	<result property="title" column="title"/>
	 	<result property="contents" column="contents"/> 	
	 	<result property="delYn" column="delYn"/>
	 	<result property="atchYn" column="atchYn"/>
	 	<result property="readCnt" column="readCnt"/> 	
	 	<result property="rgtId" column="rgtId"/>
	 	<result property="rgtDtm" column="rgtDtm"/>
	 	<result property="updId" column="updId"/>
	 	<result property="updDtm" column="updDtm"/>
	 </resultMap>

	<select id="boardInq_001" resultMap="BoardVOarr" parameterType="BoardVO">
		SELECT 
			idx
			,boardId
			,title
			,contents
			,delYn
			,atchYn
			,readCnt
			,rgtId
			,rgtDtm
			,updId
			,updDtm
		FROM board
		WHERE 1=1 
		<if test="srchKeyword != null">
			AND title LIKE CONCAT('%',#{srchKeyword},'%')
		</if>
		ORDER BY rgtDtm DESC
		LIMIT #{startIndex},#{pageSize}
	</select>

	<select id="boardInqCnt_001" resultType="Integer" parameterType="BoardVO">
		SELECT count(*)
		FROM board
		WHERE 1=1 
		<if test="srchKeyword != null">
			AND title LIKE CONCAT('%',#{srchKeyword},'%')
		</if>
	</select>
		
	
	<insert id="boardWrite_001" parameterType="boardVO">
		INSERT INTO board (
		boardId
		,title
		,contents
		,delYn
		,atchYn
		,readCnt
		,rgtId
		,rgtDtm)
		VALUES (
		'1'
		,#{title}
		,#{contents}
		,'N'
		,'N'
		,0
		,#{rgtId}
		,DATE_FORMAT(now(), '%Y%m%d%H%i%s')
		)
	</insert>
	
	<delete id="boardDelete_001" parameterType="boardVO">
		DELETE FROM board 
		WHERE idx = #{idx}		
	</delete>	
	
	<select id="boardDetail_001" resultMap="BoardVOarr" parameterType="BoardVO">
		SELECT 
			idx
			,boardId
			,title
			,contents
			,delYn
			,atchYn
			,readCnt
			,rgtId
			,rgtDtm
			,updId
			,updDtm
		FROM board
		WHERE idx = #{idx}	
	</select>
	
	<update id="boardModify_001" parameterType="boardVO">
		UPDATE board 
		SET	title = #{title}
		,contents = #{contents}
		,rgtId = #{rgtId}
		WHERE idx = #{idx}
	</update>	
	<!-- 끝 -->
	
	<update id="boardUpdateReadCnt_001" parameterType="int">
		UPDATE /*boardUpdateReadCnt_001 */
		board
		SET READCNT = READCNT+1
		WHERE IDX=#{idx}
	</update>
	
	<insert id="chboardInsert_001" parameterType="BoardVO">
		INSERT INTO /* chboardInsert*/
		board (
		boardId
		, title
		, contents
		, delYn
		, atchYn
		, readCnt
		, rgtId
		, rgtDtm) 
		values (
		#{boardId}
		, #{title}
		, #{contents}
		, 'N'
		, 'N'
		, 0
		, #{rgtId}
		, DATE_FORMAT(now(),'%Y%m%d%H%i%s')) 
		</insert>

	<update id="chbaordUpdBoard_001" parameterType="BoardVO">
		UPDATE /*chboardUpdBoard_001*/
		board SET
		 TITLE = #{title}
		, CONTENTS = #{contents}
		, RGTID = #{rgtId}
		, UPDID= #{rgtId}
		, UPDDTM = DATE_FORMAT(now(), '%Y%m%d%H%i%s')
		WHERE IDX = #{idx}
	</update>
	<select id="chboardGetList_001" parameterType="BoardVO" resultMap="BoardVOarr" >
	<![CDATA[
				SELECT * FROM board ORDER BY IDX DESC
		LIMIT #{startIndex},#{pageSize}
		]]>
	</select>
	
	<select id="chboardgetBoardCnt_001" parameterType="BoardVO" resultType="int">
		SELECT /*chboardgetBoardCnt_001*/
		COUNT(*) 
		FROM board
	</select>
	
	<delete id="chboardDelete_001"  parameterType="BoardVO">
		DELETE   /* chboardDelete_001*/
		FROM board
		WHERE IDX=#{idx}
	
	</delete>
	
	<insert id="chboardUpdateReadCnt_001" parameterType="int">
		UPDATE /*chboardUpdateReadCnt_001 */
		board
		SET READCNT = READCNT+1
		WHERE IDX=#{idx}
	
	</insert>
	<select id="chboardDetail_001" parameterType="BoardVO" resultMap="BoardVOarr">
			SELECT 
			IDX
			,BOARDID
			,TITLE
			,CONTENTS
			,DELYN
			,ATCHYN
			,READCNT
			,RGTID
			,RGTDTM
			,UPDID
			,UPDDTM
		FROM board
		WHERE IDX= #{idx}
	</select>
	
	
	<select id="chboardSchBoard_001" parameterType="HashMap" resultMap="BoardVOarr">
			SELECT * /*chboardSchBoard_001*/
			FROM board 
			WHERE 
			<if test="sel.equlas('title')">
			title like CONCAT('%',#{text},'%')
			</if>
			<if test="sel.equals('contents')">
			contents like CONCAT('%',#{text},'%')
			</if>
			ORDER BY IDX DESC
		
	
	</select>
</mapper>
